{% extends "main_layout.html" %}
{% block left_content %}
  <main id="content" role="main" class="container">

    <!-- Stock Information -->
    <div class="row">
      <div id="search-left" class="col-md-5">
        <!-- Stock information card -->
        <h5>{{ stock }}</h5>
        <p>Current Price: {{ price }}</p>
          {% if color == "green" %}
          <p>price change: <span class="green">{{ price_change }}</span></p>
          <p>% Changes: <span class="green">{{ percent_change }}</span></p>
          {% elif color == "red" %}
          <p>price change: <span class="red">{{ price_change }}</span></p>
          <p>% Changes: <span class="red">{{ percent_change }}</span></p>
          {% else %}
          <p>price change: {{ price_change }}</p>
          <p>% Changes: {{ percent_change }}</p>
        {% endif %}
      </div>
      <!-- Graph of historical data -->
      <div class="col-md-7">
        <p>This area is reserved for the graph</p>
      </div>
    </div>


    <!-- Buttons: Add/Remove stocks from watchlist -->
    <div class="row" id="add-remove">
      {% if listed == False %}
      <button id="add-to-watchlist" type="button" class="btn btn-outline-primary float-right">Add to watchlist</button>
      {% else %} 
      <button id="remove-btn" type="button" class="btn btn-danger float-right" data-toggle="modal" data-target="#exampleModal">Remove from watchlist</button>
      {% endif %}
    </div>

    
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Removal confirmation</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Are you sure to remove this stock from your watchlist?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button id="remove-from-watchlist" type="button" class="btn btn-danger float-right" data-dismiss="modal">Remove</button>
          </div>
        </div>
      </div>
    </div>
  </main>


  <script>
    var stockCode = "{{ code }}";
    var stockCode_underline = stockCode;
    stockCode = stockCode.replace(".", "_");
    
    // Add stock to watch list and update buttons
    const add = function( event ) {
      $.ajax({
        type: "POST",
        url: "/add/" + stockCode_underline,
        success: function() {
          $( "#add-to-watchlist").replaceWith('<button id="remove-btn" type="button" class="btn btn-danger float-right" data-toggle="modal" data-target="#exampleModal">Remove from watchlist</button>');
          $("#watchlist").append('<li id="'+ stockCode + '"class="list-group-item list-group-item-light">' + '{{ stock }}<br>Current Price: {{ price }}<br>');

          // Set color of labels of price information
          spanStyle = '';
          if (color == "green"){spanStyle += '<span class="green">'}
          else if (color == "red"){spanStyle += '<span class="red">'}

          // Format & Append Prices labels
          $("#"+stockCode).append('price change: ' + spanStyle + '{{ price_change }}</span><br>')
          $("#"+stockCode).append('% Changes: ' + spanStyle + + '{{ percent_change }}</span>')
          $("#watchlist").append('</li>');
          wl.add(stockCode)
        }
      })
    };    
    

    // Remove stocks from watch list and update buttons
    const del = function( event ) {
      $.ajax({
        type: "POST",
        url: "/remove/" + stockCode_underline,
        success: function() {
          newButton = '<button id="add-to-watchlist" type="button" class="btn btn-outline-primary float-right">Add to watchlist</button>';
          $("#remove-btn").replaceWith(newButton);
          
          var id = "#" + stockCode
          $(id).remove();
          
          wl.delete(stockCode)
          $("#add-to-watchlist").on( "click", add);  
          
          $("#add-remove").after('<div id="remove_alert" class="alert alert-success mt-4" role="alert">Successfully Removed</div>');
          setTimeout(function(){ $("#remove_alert").remove() }, 1000);
        }
      })
    };

      
    // Jquery code, e.g. the first line means when the element with id add-to-watchlist is clicked, run the add()
    $( "#add-to-watchlist" ).on( "click", add);    
    $( "#remove-from-watchlist" ).on( "click", del);     
  </script>
{% endblock left_content %}